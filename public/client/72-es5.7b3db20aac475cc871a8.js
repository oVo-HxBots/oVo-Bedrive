!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var i,o,r=[],a=!0,s=!1;try{for(e=e.call(t);!(a=(i=e.next()).done)&&(r.push(i.value),!n||r.length!==n);a=!0);}catch(c){s=!0,o=c}finally{try{a||null==e.return||e.return()}finally{if(s)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}(self.webpackChunkbedrive2=self.webpackChunkbedrive2||[]).push([[72],{21072:function(n,i,r){"use strict";r.r(i),r.d(i,{NotificationsModule:function(){return L}});var a=r(38583),s=r(63423),c=r(26215),u=r(45435),l=r(68939),f=r(3679),g=r(37716),d=r(90299),p=function(){var t=function(){function t(n){e(this,t),this.http=n}return o(t,[{key:"getAll",value:function(t){return this.http.get("notifications/".concat(t,"/subscriptions"))}},{key:"updateUserSubscriptions",value:function(t,n){return this.http.put("notifications/".concat(t,"/subscriptions"),{selections:n})}}]),t}();return t.\u0275fac=function(n){return new(n||t)(g.LFG(d.r))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),h=r(24688),m=r(35718),b=r(34673),v=r(70837),y=r(51095),x=r(15515),w=r(7539);function P(t,n){if(1&t){var e=g.EpF();g.TgZ(0,"div",12),g.TgZ(1,"div",13),g._uU(2),g.qZA(),g.TgZ(3,"mat-checkbox",14),g.NdJ("change",function(t){var n=g.CHM(e).$implicit,i=g.oxw(3);return t?i.toggleAllRowsFor(n):null}),g.qZA(),g.qZA()}if(2&t){var i=n.$implicit,o=g.oxw(3);g.xp6(2),g.Oqu(i),g.xp6(1),g.Q6J("checked",o.allRowsSelectedFor(i))("indeterminate",o.someRowsSelectedFor(i)&&!o.allRowsSelectedFor(i))("disabled","browser"===i&&!o.supportsBrowserNotifications)}}function k(t,n){if(1&t&&(g.ynx(0),g.YNc(1,P,4,4,"div",11),g.BQk()),2&t){var e=g.oxw(2);g.xp6(1),g.Q6J("ngForOf",e.availableChannels)}}function Z(t,n){if(1&t&&(g.TgZ(0,"div",12),g._UZ(1,"mat-checkbox",17),g.qZA()),2&t){var e=n.$implicit;g.xp6(1),g.Q6J("formControlName",e)}}function O(t,n){if(1&t&&(g.TgZ(0,"div",15),g.TgZ(1,"div",16),g._uU(2),g.qZA(),g.YNc(3,Z,2,1,"div",11),g.qZA()),2&t){var e=n.$implicit,i=n.last,o=g.oxw(2);g.ekj("no-border",i),g.Q6J("formGroupName",e.notif_id),g.xp6(2),g.Oqu(e.name),g.xp6(1),g.Q6J("ngForOf",o.availableChannels)}}function A(t,n){if(1&t&&(g.TgZ(0,"div",5),g.TgZ(1,"div",6),g.TgZ(2,"div",7),g._uU(3),g.qZA(),g.YNc(4,k,2,1,"ng-container",8),g.qZA(),g.TgZ(5,"div",9),g.YNc(6,O,4,5,"div",10),g.qZA(),g.qZA()),2&t){var e=n.$implicit,i=n.first,o=g.oxw();g.xp6(3),g.Oqu(e.group_name),g.xp6(1),g.Q6J("ngIf",i),g.xp6(1),g.Q6J("formGroup",o.form),g.xp6(1),g.Q6J("ngForOf",e.notifications)}}var C=function(){var n=function(){function n(t,i,o,r,a,s){e(this,n),this.route=t,this.api=i,this.currentUser=o,this.toast=r,this.cd=a,this.settings=s,this.availableChannels=[],this.loading$=new c.X(!1),this.supportsBrowserNotifications="Notification"in window,this.form=new f.cw({})}return o(n,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe(function(n){t.groupedNotifications=n.api.grouped_notifications,t.availableChannels=n.api.available_channels,t.initialUserSelections=n.api.user_selections,t.groupedNotifications.forEach(function(n){n.notifications.forEach(function(n){return t.addNotifFormField(n.notif_id)})})})}},{key:"addNotifFormField",value:function(t){var n=this,e=new f.cw({});this.availableChannels.forEach(function(i){var o,r=null===(o=n.initialUserSelections.find(function(n){return n.notif_id===t}))||void 0===o?void 0:o.channels[i],a=new f.NI({value:null!=r&&r,disabled:"browser"===i&&!n.supportsBrowserNotifications});"browser"===i&&"granted"!==Notification.permission&&a.valueChanges.pipe((0,u.h)(function(t){return t})).subscribe(function(t){"denied"===Notification.permission?(n.toast.open("Notifications blocked. Please enable them for this site from browser settings."),a.setValue(!1,{emitEvent:!1}),n.cd.markForCheck()):Notification.requestPermission().then(function(t){"granted"!==t&&(a.setValue(!1,{emitEvent:!1}),n.cd.markForCheck())})}),e.addControl(i,a)}),this.form.addControl(t,e)}},{key:"toggleAllRowsFor",value:function(t){var n=!this.allRowsSelectedFor(t);Object.values(this.form.controls).forEach(function(e){e.controls[t].setValue(n),e.controls[t].markAsDirty()})}},{key:"allRowsSelectedFor",value:function(t){return Object.values(this.form.controls).every(function(n){return!0===n.controls[t].value})}},{key:"someRowsSelectedFor",value:function(t){return Object.values(this.form.controls).some(function(n){return!0===n.controls[t].value})}},{key:"saveSettings",value:function(){var t=this;this.loading$.next(!0);var n=this.getPayload();this.api.updateUserSubscriptions(this.currentUser.get("id"),n).pipe((0,l.x)(function(){return t.loading$.next(!1)})).subscribe(function(){t.form.markAsPristine(),t.toast.open("Notification settings updated.")})}},{key:"getPayload",value:function(){return Object.entries(this.form.controls).filter(function(n){var e=t(n,2);e[0];return e[1].dirty}).map(function(n){var e=t(n,2);return{notif_id:e[0],channels:e[1].value}})}}]),n}();return n.\u0275fac=function(t){return new(t||n)(g.Y36(s.gz),g.Y36(p),g.Y36(h.I),g.Y36(m.F),g.Y36(g.sBO),g.Y36(b.Z))},n.\u0275cmp=g.Xpm({type:n,selectors:[["notification-subscriptions"]],decls:7,vars:5,consts:[[1,"box-shadow",3,"menuPosition"],[1,"be-container"],[1,"table","material-panel",3,"ngSubmit"],["class","setting-group",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"setting-group"],[1,"row"],["trans","",1,"name-column","strong"],[4,"ngIf"],[3,"formGroup"],["class","row indent",3,"no-border","formGroupName",4,"ngFor","ngForOf"],["class","channel-column",4,"ngFor","ngForOf"],[1,"channel-column"],["trans","",1,"channel-name"],[3,"checked","indeterminate","disabled","change"],[1,"row","indent",3,"formGroupName"],["trans","",1,"name-column"],[3,"formControlName"]],template:function(t,n){1&t&&(g._UZ(0,"material-navbar",0),g.TgZ(1,"div",1),g.TgZ(2,"form",2),g.NdJ("ngSubmit",function(){return n.saveSettings()}),g.YNc(3,A,7,4,"div",3),g.TgZ(4,"button",4),g.ALo(5,"async"),g._uU(6,"Save Settings"),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.Q6J("menuPosition",n.settings.get("vebto.navbar.defaultPosition")),g.xp6(3),g.Q6J("ngForOf",n.groupedNotifications),g.xp6(1),g.Q6J("disabled",g.lcZ(5,3,n.loading$)))},directives:[v.e,f._Y,f.JL,f.F,a.sg,y.lW,x.P,a.O5,f.sg,w.oG,f.x0,f.JJ,f.u],pipes:[a.Ov],styles:["[_nghost-%COMP%]{display:block;background-color:var(--be-background-alternative);min-height:100vh}.be-container[_ngcontent-%COMP%]{padding-top:35px;padding-bottom:35px}.table[_ngcontent-%COMP%]{border-radius:4px}.setting-group[_ngcontent-%COMP%]{margin-bottom:10px}.row[_ngcontent-%COMP%]{display:flex;align-items:center;border-bottom:1px solid var(--be-divider-default);padding:10px}.row.no-border[_ngcontent-%COMP%]{border-bottom:none}.row.indent[_ngcontent-%COMP%]{padding-left:20px}.name-column[_ngcontent-%COMP%]{flex:1 1 auto}.strong[_ngcontent-%COMP%]{font-weight:500;font-size:1.5rem;align-self:flex-end}.channel-name[_ngcontent-%COMP%]{margin-bottom:10px}.channel-column[_ngcontent-%COMP%]{width:75px;text-align:center;text-transform:capitalize}.submit-button[_ngcontent-%COMP%]{margin-top:15px}"],changeDetection:0}),n}(),_=r(5304),F=r(19773),N=r(59193),J=r(25917),q=function(){var t=function(){function t(n,i,o){e(this,t),this.router=n,this.subscriptions=i,this.currentUser=o}return o(t,[{key:"resolve",value:function(t,n){var e=this;return this.subscriptions.getAll(+this.currentUser.get("id")).pipe((0,_.K)(function(){return e.router.navigate(["/account/settings"]),N.E}),(0,F.zg)(function(t){return t?(0,J.of)(t):(e.router.navigate(["/account/settings"]),N.E)}))}}]),t}();return t.\u0275fac=function(n){return new(n||t)(g.LFG(s.F0),g.LFG(p),g.LFG(h.I))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),M=r(99665),T=r(96605),S=r(31682);function U(t,n){if(1&t){var e=g.EpF();g.TgZ(0,"li"),g.TgZ(1,"button",4),g.NdJ("click",function(){var t=g.CHM(e).$implicit;return g.oxw().selectPage(t)}),g._uU(2),g.qZA(),g.qZA()}if(2&t){var i=n.$implicit,o=g.oxw();g.xp6(1),g.ekj("active",o.currentPage===i),g.Q6J("disabled",o.disabled),g.xp6(1),g.Oqu(i)}}var Y,Q,$=function(){var t=function(){function t(n){e(this,t),this.router=n,this.pageChanged=new g.vpe,this.disabled=!0}return o(t,[{key:"shouldHide",get:function(){return this.numberOfPages<2}},{key:"pagination",set:function(t){t&&(this.numberOfPages=t.last_page>10?10:t.last_page,this.numberOfPages>1&&(this.iterator=Array.from(Array(this.numberOfPages).keys()).map(function(t){return t+1}),this.currentPage=t.current_page))}},{key:"selectPage",value:function(t){this.currentPage!==t&&(this.currentPage=t,this.pageChanged.next(t),this.router.navigate([],{queryParams:{page:t},replaceUrl:!0}))}},{key:"nextPage",value:function(){var t=this.currentPage+1;this.selectPage(t<=this.numberOfPages?t:this.currentPage)}},{key:"prevPage",value:function(){var t=this.currentPage-1;this.selectPage(t>=1?t:this.currentPage)}}]),t}();return t.\u0275fac=function(n){return new(n||t)(g.Y36(s.F0))},t.\u0275cmp=g.Xpm({type:t,selectors:[["pagination-widget"]],hostVars:2,hostBindings:function(t,n){2&t&&g.ekj("hidden",n.shouldHide)},inputs:{disabled:"disabled",pagination:"pagination"},outputs:{pageChanged:"pageChanged"},decls:8,vars:3,consts:[[1,"page-numbers","unstyled-list"],["type","button","mat-button","","trans","",1,"prev",3,"disabled","click"],[4,"ngFor","ngForOf"],["type","button","mat-button","","trans","",1,"next",3,"disabled","click"],["type","button","mat-flat-button","","color","gray",1,"page-number-button",3,"disabled","click"]],template:function(t,n){1&t&&(g.TgZ(0,"ul",0),g.TgZ(1,"li"),g.TgZ(2,"button",1),g.NdJ("click",function(){return n.prevPage()}),g._uU(3,"Previous"),g.qZA(),g.qZA(),g.YNc(4,U,3,4,"li",2),g.TgZ(5,"li"),g.TgZ(6,"button",3),g.NdJ("click",function(){return n.nextPage()}),g._uU(7,"Next"),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.xp6(2),g.Q6J("disabled",n.disabled),g.xp6(2),g.Q6J("ngForOf",n.iterator),g.xp6(2),g.Q6J("disabled",n.disabled))},directives:[y.lW,x.P,a.sg],styles:["[_nghost-%COMP%]{display:block}ul[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-wrap:wrap;width:100%}li[_ngcontent-%COMP%]{margin:0 3px 6px}.page-number-button[_ngcontent-%COMP%]{width:40px;height:40px;min-width:40px;line-height:40px;padding:0}.active[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.next[_ngcontent-%COMP%], .prev[_ngcontent-%COMP%]{color:var(--be-accent-default)}"],changeDetection:0}),t}(),j=[{path:"",component:(Y=function(){function t(n,i,o,r){e(this,t),this.settings=n,this.notifications=i,this.breakpoints=o,this.route=r,this.pagination$=new c.X(null)}return o(t,[{key:"ngOnInit",value:function(){this.loadPage(this.route.snapshot.queryParams.page||1)}},{key:"loadPage",value:function(t){var n=this;this.notifications.load({page:t,perPage:25}).subscribe(function(t){n.pagination$.next(t.pagination)})}},{key:"markAsRead",value:function(t){this.pagination$.value.data.find(function(n){return n.id===t.id}).read_at=t.read_at}}]),t}(),Y.\u0275fac=function(t){return new(t||Y)(g.Y36(b.Z),g.Y36(M.g),g.Y36(T.S),g.Y36(s.gz))},Y.\u0275cmp=g.Xpm({type:Y,selectors:[["notification-page"]],decls:8,vars:13,consts:[[3,"menuPosition"],[1,"be-container"],[3,"notifications","compact","markedAsRead"],[3,"pagination","disabled","pageChanged"]],template:function(t,n){var e;1&t&&(g._UZ(0,"material-navbar",0),g.TgZ(1,"div",1),g.TgZ(2,"notification-list",2),g.NdJ("markedAsRead",function(t){return n.markAsRead(t)}),g.ALo(3,"async"),g.ALo(4,"async"),g.qZA(),g.TgZ(5,"pagination-widget",3),g.NdJ("pageChanged",function(t){return n.loadPage(t)}),g.ALo(6,"async"),g.ALo(7,"async"),g.qZA(),g.qZA()),2&t&&(g.Q6J("menuPosition",n.settings.get("vebto.navbar.defaultPosition")),g.xp6(2),g.Q6J("notifications",null==(e=g.lcZ(3,5,n.pagination$))?null:e.data)("compact",g.lcZ(4,7,n.breakpoints.isMobile$)),g.xp6(3),g.Q6J("pagination",g.lcZ(6,9,n.pagination$))("disabled",g.lcZ(7,11,n.notifications.loading$)))},directives:[v.e,S.Z,$],pipes:[a.Ov],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background-color:var(--be-background-alternative)}.be-container[_ngcontent-%COMP%]{padding-top:25px;padding-bottom:25px}pagination-widget[_ngcontent-%COMP%]{margin-top:35px}"],changeDetection:0}),Y)},{path:"settings",component:C,resolve:{api:q},data:{permissions:["notification.subscribe"]}}],E=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[s.Bz.forChild(j)],s.Bz]}),t}(),I=r(68285),R=r(40744),z=r(18295),B=r(49866),G=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[a.ez,y.ot,B.N]]}),t}(),L=((Q=function t(){e(this,t)}).\u0275fac=function(t){return new(t||Q)},Q.\u0275mod=g.oAB({type:Q}),Q.\u0275inj=g.cJS({imports:[[a.ez,f.u5,f.UX,E,z.l,I.T,R.m,G,B.N,w.p9,y.ot]]}),Q)}}])}();
//# sourceMappingURL=72-es5.7b3db20aac475cc871a8.js.map